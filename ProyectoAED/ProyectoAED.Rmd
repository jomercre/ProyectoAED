---
title: Proyecto de AED
author:
  - name: Joan Merlos Cremades
    affil: 1,*
  - name: Héctor Torres Muñoz
    affil: 2
affiliation:
  - num: 1
    address:
      Universitat de València
    email: joanmer@alumni.uv.es
  - num: 2
    address:
      Universitat de València
    email: hecto2@alumni.uv.es
correspondence:
  joanmer@alumni.uv.es
# document options
journal: notspecified
type: article
status: submit
# front matter
simplesummary: |
  Proyecto de la asignatura Ánalisis exploratorio de datos del Máster en Ciencia de datos de la Universitat de València.
abstract: |
  En las siguientes páginas se encuentra ...
keywords: |
  Análisis exploratorio de datos, INE, Inserción laboral.
bibliography: mybibfile.bib
endnotes: false
output: 
  rticles::mdpi_article:
    extra_dependencies: longtable
---

# Aclaración de los datos

En la carpeta de datos original se pueden observar dos archivos completamente diferentes, el archivo que se va a proceder a analizar es el de la gente que se graduó en una universidad española durante el curso 2013-2014 (EILU_GRAD_2019.csv). El otro archivo corresponde a la gente que obtuvo un máster en el curso 2013-2014, por lo que no será objeto de nuestro estudio. Habiendo aclarado ya el conjunto de datos a utilizar podemos proceder a analizarlo, limpiarlo y estudiarlo.

# Importación de los datos

En este apartado vamos a proceder a importar el archivo de datos con el que vamos a trabajar, el cual pertenece al INE (Insituto Nacional de Estadística) y trata sobre la inserción laboral de las personas con estudios universitarios o superiores.


Importamos las librerías que vamos a utilizar:
```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(vcd)
```


Importamos los datos:
```{r}
df_raw <- read_delim("./data/EILU_GRAD_2019.csv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
```
# Preparación de los datos

En primer lugar, seleccionaremos las variables de interés:
```{r}
var <- c('IDENT','SEXO','EDAD','TITU','RAMA','AMBITO','T_UNIV','EST_B12','EST_B16',
         'EST_B13_AMB1','EST_B13_AMB2','EST_B13_AMB3','EST_B17_M1','EST_B17_M2',
         'EST_B17_M3','EST_B21','EST2_SA','IDIOMAS','TRBPRN1','TR_SUELDO',
         'HATR_E11')

df <- df_raw[var]
```

Asignamos a cada variable su tipo, exceptuando a las variables EST_B..., ya qu estas las fusionaremos más adelante como una matriz de tipo factor.
```{r}
df$SEXO <- factor(df$SEXO, levels = c(1,2), labels = c('Hombre', 'Mujer'))
df$EDAD <- as.numeric(df$EDAD)

codi <- c("011101", "011201", "011301", "011401", "011901", "021101", "021201", "021301", "021302", "021401", "021502", "022201", "022202", "022301", "022901", "023101", "023102", "023103", "023104", "023201", "023202", "023901", "031101", "031201", "031202", "031301", "031401", "031402", "031404", "031406", "032101", "032102", "032201", "041201", "041202", "041301", "041302", "041303", "041401", "041402", "041403", "041601", "042101", "051101", "051201", "051202", "051901", "052101", "053101", "053201", "053202", "053203", "053301", "054101", "054201", "061301", "061901", "071101", "071301", "071302", "071401", "071402", "071403", "071404", "071405", "071501", "071502", "071503", "071601", "071603", "071901", "072101", "072102", "072201", "072401", "073101", "073102", "073201", "073202", "081102", "081103", "081201", "082101", "084101", "091101", "091201", "091301", "091401", "091402", "091501", "091502", "091503", "091504", "091505", "091601", "092301", "101401", "101501", "104101", "104103", "109999")

descrip <- c("Pedagogía", "Educación infantil", "Educación primaria", "Otros maestros", "Educación social", "Audiovisual, imagen y multimedia", "Diseño", "Bellas artes", "Historia del arte", "Conservación y restauración", "Música y Artes escénicas", "Arqueología", "Historia", "Filosofía", "Humanidades", "Lengua inglesa", "Lenguas clásicas", "Otras lenguas extranjeras", "Traducción e interpretación", "Lenguas y dialectos españoles", "Literatura", "Lenguas modernas y aplicadas", "Economía", "Política y gestión pública", "Relaciones internacionales", "Psicología", "Antropología social y cultural y Estudios y gestión de la cultura", "Criminología", "Geografía", "Sociología e Igualdad de género", "Comunicación", "Periodismo", "Información y documentación", "Financiera y actuarial", "Finanzas y contabilidad", "Administración y empresa", "Ciencias del trabajo", "Gestión y administración pública", "Marketing", "Protocolo y eventos", "Publicidad y relaciones públicas", "Comercio", "Derecho", "Biología", "Bioquímica", "Biotecnología", "Biomedicina", "Ciencias ambientales", "Química", "Ciencias del mar", "Geografía y ordenación del territorio", "Geología", "Física", "Matemáticas", "Estadística", "Desarrollo de software y de aplicaciones e Ingeniería multimedia", "Informática", "Ingeniería química industrial e Ingeniería medioambiental", "Ingeniería de la energía", "Ingeniería eléctrica", "Ingeniería de computadores", "Ingeniería de sonido e imagen", "Ingeniería de telecomunicación", "Ingeniería electrónica industrial y automática", "Ingeniería en electrónica", "Ingeniería en diseño industrial y desarrollo del producto", "Ingeniería en tecnologías industriales", "Ingeniería mecánica", "Ingeniería aeronáutica", "Ingeniería naval y oceánica", "Ingeniería de organización industrial y Nanotecnología", "Ciencia y tecnología de los alimentos e Ingeniería alimentaria", "Enología", "Ingeniería de materiales e Ingeniería textil", "Ingeniería de minas y energía", "Arquitectura y Urbanismo y paisajismo", "Ingeniería geomática, topografía y cartografía", "Arquitectura técnica", "Ingeniería civil", "Ingeniería agraria y agroalimentaria", "Ingeniería agrícola, agropecuaria y medio rural", "Ingeniería horticultura y jardinería", "Ingeniería forestal y montes", "Veterinaria", "Odontología", "Medicina", "Enfermería", "Ingeniería biomédica y de la salud", "Óptica y optometría", "Fisioterapia", "Logopedia", "Nutrición humana y dietética", "Podología", "Terapia ocupacional", "Farmacia", "Trabajo social", "Actividad física y del deporte", "Turismo", "Náutica y transporte marítimo", "Servicio de transporte terrestre y Servicio de transporte aéreo", "Servicios (otros estudios)")

df$TITU <- factor(df$TITU, levels=codi, labels=descrip)

codi_amb <- c("0112", "0113", "011", "0211", "021", "022", "023", "0311", "0313", "031", "032", "0413", "041", "042", "051", "052", "053", "054", "061", "071", "072", "073", "081", "082", "084", "0912", "0913", "091", "092", "1014", "1015", "109", "9999")
desc_amb <- c("Formación de docentes de enseñanza infantil", "Formación de docentes de enseñanza primaria", "Educación (Otros estudios)", "Técnicas audiovisuales y medios de comunicación", "Artes (Otros estudios)", "Humanidades", "Lenguas", "Economía", "Psicología", "Ciencias sociales y del comportamiento (Otros estudios)", "Periodismo y documentación", "Dirección y administración", "Negocios y administración (Otros estudios)", "Derecho", "Ciencias de la vida", "Medio ambiente", "Ciencias químicas, físicas y geológicas", "Matemáticas y estadística", "Informática", "Ingeniería y profesiones afines", "Industria manufacturera y producción", "Arquitectura y construcción", "Agricultura y ganadería", "Silvicultura", "Veterinaria", "Medicina", "Enfermería", "Salud (Otros estudios)", "Servicios sociales", "Actividades físicas y deportivas", "Viajes, turismo y ocio", "Servicios (Otros estudios)", "NS/NC")

df$AMBITO <- factor(df$AMBITO, levels=codi_amb, labels=desc_amb)

df <- df %>% mutate(AMBITO = ifelse(AMBITO == "NS/NC",NA, AMBITO))

codi_rama <- c(1, 2, 3, 4, 5)
desc_rama <- c("Artes y humanidades", "Ciencias", "Ciencias sociales y jurídicas", "Ingeniería y arquitectura", "Ciencias de la salud")

df$RAMA <- factor(df$RAMA, levels=codi_rama, labels=desc_rama)

codi_tipu <- c(1, 2, 3, 4)
desc_tipu <- c("Universidad Pública presencial", "Universidad Pública a distancia", "Universidad Privada presencial", "Universidad Privada a distancia")

df$T_UNIV <- factor(df$T_UNIV, levels=codi_tipu, labels=desc_tipu)

codi_idi <- c("0", "1", "2", "3", "4", "5", "9")
desc_idi <- c("0", "1", "2", "3", "4", "5 o más", "NS/NC")

df$IDIOMAS <- factor(df$IDIOMAS, levels=codi_idi, labels=desc_idi)

df <- df %>% mutate(IDIOMAS = ifelse(IDIOMAS == "NS/NC",NA, IDIOMAS))

codi_empl <- c(1, 2, 3)
desc_empl <- c("Trabajando", "En desempleo", "Inactivo")

df$TRBPRN1 <- factor(df$TRBPRN1, levels=codi_empl, labels=desc_empl)

codi_sueldo <- c("1", "2", "3", "4", "5", "6", "7", "9")
desc_sueldo <- c("Menos de 700 euros", "De 700 a 999 euros", "De 1.000 a 1.499 euros", "De 1.500 a 1.999 euros", "De 2.000 a 2.499 euros", "De 2.500 a 2.999 euros", "De 3.000 euros en adelante", "NS/NC")

df$TR_SUELDO <- factor(df$TR_SUELDO, levels=codi_sueldo, labels=desc_sueldo)

df <- df %>% mutate(TR_SUELDO = ifelse(TR_SUELDO == "NS/NC",NA, TR_SUELDO))

codi_tiempo1 <- c("0", "1", "2", "3", "4", "5", "6", "9")
desc_tiempo1 <- c("Continuó al menos 6 meses más en el trabajo que tenía", "Menos de tres meses", "De 3 a 6 meses", "De 6 meses a 1 año", "De 1 año a año y medio", "De 1 año y medio a 2 años", "2 o más años", "NS/NC")

df$HATR_E11 <- factor(df$HATR_E11, levels=codi_tiempo1, labels=desc_tiempo1)

df <- df %>% mutate(HATR_E11 = ifelse(HATR_E11 == "NS/NC",NA, HATR_E11))
```

Observamos la cantidad de respuestas vacías en las columnas sobre el MIR, el ámbito de estudio de la primera carrera y la rama de la carrera.
```{r}
sum(is.na(df$EST_B13_AMB1))

sum(is.na(df$EST2_SA))

sum(is.na(df$RAMA))
```
Descartamos la columna del MIR, ya que todo aquel que se encuentre realizándolo o ya lo haya realizado necesariamente debe haver realizado una carrera o máster de la rama de ciencias de la salut. Por tanto, no es redundante conocer esa información para crear la columna con la rama del último estudio realizado.

Seguidamente, nos disponemos a analizar las variables que comienzan por EST, estas poseen información del tipo de estudios que ha realizado y del tipo de cada estudio. Nuestra intención es utilizar dicha información para obtener la cantidad de grados, másteres y carreras que tiene cada entrevistado y además obtener una columna en la que se observe el ámbito del estudio de más nivel que tenga. Para ello vamos a utilizar la librería __dplyr__ en conjunto con las funciones 'mutate' y 'pipe'. Asumimos que los NA significa que no poseen ese estudio. Podríamos ignorar muchas de las columnas porqué hay muy poca gente con 3 grados o 3 máster, peró aún así intentamos mantener los máximos datos posibles
```{r}
df <- df %>% 
  mutate(URAMA = ifelse(!is.na(EST_B21), EST_B21, 
    ifelse(!is.na(EST_B17_M3), EST_B17_M3,
        ifelse(!is.na(EST_B17_M2), EST_B17_M2,
          ifelse(!is.na(EST_B17_M1), EST_B17_M1,
                 RAMA)))))

codi_urama <- c(1, 2, 3, 4, 5)
desc_urama <- c("Artes y humanidades", "Ciencias", "Ciencias sociales y jurídicas", "Ingeniería y arquitectura", "Ciencias de la salud")

df$URAMA <- factor(df$URAMA, levels=codi_urama, labels=desc_urama)
```
Podemos comprobar ahora cuantas personas se han cambiado de rama en comparación con la carrera realizada.
```{r}
sum(sum(df$URAMA != df$RAMA))
```
Una vez se ha obtenido la columna URAMA podemos eliminar del dataframe todas aquellas columnas que no nos son relevantes para graficar.
```{r}
df <- df %>% select(-c('EST_B13_AMB1','EST_B13_AMB2','EST_B13_AMB3','EST_B17_M1',
                       'EST_B17_M2','EST_B17_M3','EST_B21','EST2_SA'))
```


Graficamos ahora dos gráficos de barras comparando la columna con la rama de la primera titulación con la rama del último estudio realizado.
```{r}
ggplot(data=df, aes(x = RAMA)) + geom_bar(aes(fill=SEXO)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) + 
  scale_y_continuous(limits = c(0, 16000))
ggplot(data=df, aes(x = URAMA)) + geom_bar(aes(fill=SEXO)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) +
  scale_y_continuous(limits = c(0, 16000))
```
Graficamos en un gráfico de barras los estados laborales de las personas analizadas.
```{r}
ggplot(data=df, aes(x = TRBPRN1)) + geom_bar(aes(fill=T_UNIV)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```
De forma auxiliar generamos un dataframe en el que solo se encuentre la población de la encuesta que se encuentra trabajando.
```{r}
df_tra <- df %>% filter(TRBPRN1=='Trabajando')
```

# Gráficas

Estadísticas del tipo de universidad.
```{r}
ggplot(data=df, aes(x = T_UNIV)) + geom_bar(aes(fill=SEXO)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```
Como podemos observar la gran mayoría de la gente ha estudiado de forma presencial en una universidad pública por lo que utilizar el factor de tipo de universidad para estudios siguientes puede no ser estadísticamente correcto, ya que hay oversampling.

Variación del tiempo transcurrido hasta que empezo a trabajar según su universidad.
```{r}
df_plot <- df %>% filter(!is.na(HATR_E11)) %>% filter(HATR_E11!='NS/NC')

ggplot(data=df_plot, aes(x = HATR_E11)) + geom_bar(aes(fill=T_UNIV)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```
Variación del tiempo transcurrido hasta que empezo a trabajar según su rama.
```{r}
# Quitamos los registros NA y graficamos

df_plot <- df %>% filter(!is.na(HATR_E11)) %>% filter(HATR_E11!='NS/NC')

ggplot(data=df_plot, aes(x = HATR_E11)) + geom_bar(aes(fill=URAMA)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))
```
Situación laboral separando por el tipo de rama del estudio más elevado.

```{r}
# Quitamos los registros NA y graficamos

df_plot <- df %>% filter(!is.na(TRBPRN1))

ggplot(df_plot, aes(x= TRBPRN1)) + geom_bar(aes(fill=URAMA)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))
```

Número de idiomas frente a situación laboral.
```{r}
# Quitamos los registros NA y graficamos

df_plot <- df %>% filter(!is.na(TRBPRN1)) %>% filter(IDIOMAS != 'NS/NC')

ggplot(df_plot, aes(x=IDIOMAS)) + geom_bar(aes(fill=SEXO)) + facet_wrap(~TRBPRN1) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```

Rama del estudio más elevado en función de la situación laboral.
```{r}
df_plot <- df %>% filter(!is.na(TRBPRN1))

ggplot(df_plot, aes(x=URAMA)) + geom_bar(aes(fill=SEXO)) + facet_wrap(~TRBPRN1) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```





