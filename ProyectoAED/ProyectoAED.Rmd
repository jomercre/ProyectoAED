---
title: Proyecto de AED - Inserción laboral de titulados universitarios
author:
  - name: Joan Merlos Cremades
    affil: 1,*
  - name: Héctor Torres Muñoz
    affil: 2
affiliation:
  - num: 1
    address:
      Universitat de València
    email: joanmer@alumni.uv.es
  - num: 2
    address:
      Universitat de València
    email: hecto2@alumni.uv.es
correspondence:
  joanmer@alumni.uv.es
# document options
journal: notspecified
type: article
status: submit
# front matter
simplesummary: |
  Proyecto de la asignatura Ánalisis exploratorio de datos del Máster en Ciencia de datos de la Universitat de València.
abstract: |
  En las siguientes páginas, se encuentra un estudio exploratorio de los datos correspondientes a la inserción laboral de los estudiantes universitarios que finalizaron su grado durante el curso 2013-2014, dichos datos fueron recogidos por el Instutito Nacional de Estadística (INE) y se pueden descargar de forma libre accediendo al siguiente enlace \url{https://www.ine.es/ftp/microdatos/eilu/datos_2019.zip}. Dicho análisis consistirá en transformar los datos a sus correspondientes tipos, renombrar los factores para que tengan nombres representativos, estudiar las posibles relaciones entre las diferentes variables e imputar variables de interés.
keywords: |
  Análisis exploratorio de datos, INE, Inserción laboral.
bibliography: mybibfile.bib
endnotes: false
output: 
  rticles::mdpi_article:
    extra_dependencies: longtable
---

```{r, echo = FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```

# Introducción

En la carpeta de datos original, se pueden observar dos archivos de datos CSV diferentes. El archivo que se va a proceder a analizar es el de la gente que se graduó en una universidad española durante el curso 2013-2014 ( __EILU_GRAD_2019.csv__ ). El otro archivo corresponde a la gente que obtuvo un máster en el curso 2013-2014, por lo que no será objeto de nuestro estudio. Habiendo aclarado ya el conjunto de datos a utilizar podemos proceder a importar las librerías que nos permitirán analizarlo, limpiarlo y estudiarlo.

```{r}
pacman::p_load(readr,dplyr,ggplot2,vcd,patchwork,knitr)
```


# Importación y limpieza de datos 

En este apartado vamos a proceder a importar el archivo de datos con el que vamos a trabajar. Para ello primero debemos de adivinar su codificación mediante el uso de la función *guess_encoding*.
```{r}
# Adivinamos la codificación 

guess_encoding("./data/EILU_GRAD_2019.csv")
```

Una vez que sabemos que la codificación de nuestros datos es ASCII, podemos proceder a importarlos teniendo en cuenta que estan en formato CSV y que los diferentes valores se encuentran separados por tabulador.
```{r,message=FALSE,warning=FALSE}
df_raw <- read_delim("./data/EILU_GRAD_2019.csv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE, locale = locale(encoding = "ASCII"))
```

El dataframe importado tiene una longitud de ```r ncol(df_raw)``` variables, así que para falicitar nuestro estudio nos quedaremos únicamente con las variables principales que afectan a los estudios, la situación laboral y el sueldo de los diferentes individuos. Para conocer que representa cada una de las distintas variables debemos acudir al codebook de los metadatos, este viene dado por el archivo xlsx denominado __dr_EILU_GRAD_2019.xlsx__. Cabe destacar que en el proyecto de R donde se encuentra este documento pdf también hemos añadido dicho archivo para que cualquier persona pueda identificar las variables sin necesidad de abrir el archivo original de metadatos.
```{r}
var <- c('IDENT','SEXO','RAMA','EST_B17_M1','EST_B17_M2','EST_B17_M3',
         'EST_B21','IDIOMAS','TRBPRN1','TR_SUELDO','HATR_E11')

df <- df_raw[var]
```

Una vez que ya tenemos seleccionadas las variables con las que vamos a realizar nuestro estudio debemos pasar cada una de ellas a su respectivo tipo. Dicha tarea se vuelve un poco tediosa debido a que las diferentes variables de tipo factor han sido codificadas mediante índices numéricos, para saber que simboliza cada uno de estos números debemos, otra vez, acudir al codebook de los metadatos. Una vez que podemos comprender que significa cada número debemos convertir las diferentes columnas en tipo factor mediante la función *factor* introduciendo en el parámetro *levels* los valores codificados correspondientes a cada nivel del factor y en la parámetro *labels* el nuevo nombre que queremos asociar a cada nivel del factor, el cual debe ser los suficientemente indicativo para poder interpretarlo más adelante en las distintas gráficas exploratorias que se realizaran. Por otro lado, para modelizar los datos faltantes hemos utilizado el tipo NA Cabe destacar que todo este proceso se encuentra en el documento Rmd asociado, ya que es algo extenso y consideramos redundante introducirlo en este informe.
```{r, echo=FALSE}
df$SEXO <- factor(df$SEXO, levels = c(1,2), labels = c('Hombre', 'Mujer'))

codi_rama <- c(1, 2, 3, 4, 5)
desc_rama <- c("Artes y humanidades", "Ciencias", 
               "Ciencias sociales y jurídicas", "Ingeniería y arquitectura",
               "Ciencias de la salud")

df$RAMA <- factor(df$RAMA, levels=codi_rama, labels=desc_rama)

codi_idi <- c("0", "1", "2", "3", "4", "5")
desc_idi <- c("0", "1", "2", "3", "4", "5 o más")

df <- df %>% mutate(IDIOMAS = ifelse(IDIOMAS == "9",NA, IDIOMAS)) # 9 = NA

df$IDIOMAS <- factor(df$IDIOMAS, levels=codi_idi, labels=desc_idi)

codi_empl <- c(1, 2, 3)
desc_empl <- c("Trabajando", "En desempleo", "Inactivo")

df$TRBPRN1 <- factor(df$TRBPRN1, levels=codi_empl, labels=desc_empl)

codi_sueldo <- c("1", "2", "3", "4", "5", "6", "7")
desc_sueldo <- c("Menos de 700 euros",
                 "De 700 a 999 euros",
                 "De 1.000 a 1.499 euros",
                 "De 1.500 a 1.999 euros",
                 "De 2.000 a 2.499 euros",
                 "De 2.500 a 2.999 euros",
                 "De 3.000 euros en adelante")

df <- df %>% mutate(TR_SUELDO = ifelse(TRBPRN1 == "9",NA, TR_SUELDO)) # 9 = NA

df$TR_SUELDO <- factor(df$TR_SUELDO, levels=codi_sueldo, 
                       labels=desc_sueldo,ordered=T)

codi_tiempo1 <- c("0", "1", "2", "3", "4", "5", "6")
desc_tiempo1 <- c("Continuó (+ 6 meses)", "< 3 meses", "3-6 meses", "6 meses-1 año", "1-1.5 años", "1.5-2 años", ">= 2 años")

df <- df %>% mutate(HATR_E11 = ifelse(TRBPRN1 == "9",NA, HATR_E11)) # 9 = NA

df$HATR_E11 <- factor(df$HATR_E11, levels=codi_tiempo1, labels=desc_tiempo1)
```

Antes de pasar al siguiente apartado, vamos a intentar convertir todas las variables que nos indican la rama de los estudios realizados por cada individuo en una sola. La rama que nos aporta la rama del primer estudio universitario realizado por el individuo se denomina *RAMA*. No osbtante, después tenemos más variables que nos indican la rama de los másteres realizados por el individuo o la rama del doctorado más importante. Para reducir todas estas múltiples variables a una sola vamos a crear la variable *URAMA*, la cual nos va indicar la rama del estudio más elevado realizado por el individuo, es decir, los cuales en la mayoría de casos coincidiran con los últimos estudios realizados por el individuo. Cabe destacar que vamos a ignorar la variable dedicada a los estudios del del tipo MIR, ya que todo aquel que se encuentre realizándolo o ya lo haya realizado necesariamente debe haber realizado una carrera o máster de la rama de ciencias de la salud. Por tanto, nos es redundante conocer esa información para crear la columna con la rama del último estudio realizado.

Para crear la variable *URAMA* simplemente debemos tener en cuenta que cuando el individuo no ha dado información sobre el estudio o directamente no ha realizado dicho estudio la columna aparecera como NA, así que vamos estudiando que columnas continen datos no faltantes empezando por los doctorados, siguiendo por los másteres y terminando en los grados o licenciaturas.
```{r}
df <- df %>% 
  mutate(URAMA = ifelse(!is.na(EST_B21), EST_B21, 
    ifelse(!is.na(EST_B17_M3), EST_B17_M3,
        ifelse(!is.na(EST_B17_M2), EST_B17_M2,
          ifelse(!is.na(EST_B17_M1), EST_B17_M1,
                 RAMA)))))

codi_urama <- c(1, 2, 3, 4, 5)
desc_urama <- c("Artes y humanidades", "Ciencias", 
                "Ciencias sociales y jurídicas", "Ingeniería y arquitectura",
                "Ciencias de la salud")

df$URAMA <- factor(df$URAMA, levels=codi_urama, labels=desc_urama)
```

Una vez se ha obtenido la columna *URAMA* podemos eliminar del dataframe las variables con información sobre las ramas de los másteres o la columna que contiene la rama del doctorado más importante.
```{r}
df <- df %>% select(-c('EST_B17_M1','EST_B17_M2','EST_B17_M3','EST_B21'))
```

# Inspección de datos faltantes

En este apartado, vamos a proceder a estudiar los datos faltantes en cada columna del dataframe con información, es decir, vamos a obviar la columna con el identificador.

```{r tab1, echo=FALSE}
nasum <- c()

for (i in 1:(length(names(df))-1)){
  nasum[i] <- sum(is.na(df[i+1]))
}
  

dfT1 <- data.frame('Variable' = names(df)[2:length(names(df))],
                 'Número de datos faltantes' = nasum,check.names = FALSE)

kable(dfT1, format = "latex",booktabs = TRUE,
  caption = "Cantidad de NA's en función de la variable",
  align = 'l|c', longtable = TRUE,linesep = "")
```

Como podemos observar las únicas columnas con datos faltantes son *IDIOMAS*, *TR_SUELDO* y *HATR_E11*. La variable con más datos faltantes es TR_SUELDO con un ```r round(sum(is.na(df$TR_SUELDO))/nrow(df)*100,2)``` % de datos con NA. No obstante, no todos ellos son datos faltantes, ya que puede darse el caso de que la persona no esté actualmente trabajando y, por tanto, haya evitado rellenar a drede la casilla de *TR_Sueldo*. Para observar cuales son en realidad nuestros datos faltantes procedemos a observar el número de NA's de la variable *TR_SUELDO* una vez hemos eliminado aquellas personas que no se encuentran trabajando.
```{r tab2, echo=FALSE}
dfNAc <- df %>% filter(TRBPRN1 == 'Trabajando')

NAs <- c(sum(is.na(df$TR_SUELDO)),sum(is.na(dfNAc$TR_SUELDO)))

dfT2 <- data.frame('Variable' = c('TR_SUELDO','TR_SUELDO'),
                  'Cálculo' = c('Con todos los datos',
                                'Con la gente activa laboralmente'),
                  'Número de datos faltantes' = NAs,
                  check.names = FALSE)

kable(dfT2, format = "latex",booktabs = TRUE,
  caption = "Cantidad de Na's en la variable TR\\_SUELDO cuando se elimina la cantidad de gente que no está activa laboralmente",
  align = 'l|c|c', longtable = TRUE,linesep = "")
```

Como podemos observar hay aproximadamente 4500 valores NA que pertenecen a la población no activa laboralmente, la cual es lógico que no tenga un salario. No obstante, los otros 700 datos con NA no parecen seguir ninguna lógica. Por ello intentaremos relacionar la variable *TR_SUELDO* con alguna otra variable del conjunto que no contenga datos faltantes.

# Imputación de datos faltantes

Queremos imputar los valores de la variable con el sueldo para aquellas personas que se encuentran activas, para ello lo que vamos a hacer va a ser primero aplicar el test del $\chi^2$ a la combinación de la variable *TR_SUELDO* con el resto de variables, evitando las variables IDENT porque no tiene sentido relacionarla con el identificador y la variable *TRBPRN1* porque si eliminamos los NA's de la variable *TR_SUELDO*, aquellas personas que no estan laboralmente activas se eliminan y no tiene sentido realizar la table de contingencia porque dos columnas valen siempre 0.

```{r, echo=FALSE}
colNam <- names(df %>% select(-IDENT,-TR_SUELDO, -TRBPRN1, -RAMA))
dfAUX2 <- df %>% na.omit()

p <- c()
V <- c()

sueldo <- c()

for (i in 1:length(colNam)){
  
  tabla <- table(dfAUX2$TR_SUELDO, dfAUX2[[colNam[i]]])
  
  test <- chisq.test(tabla)
  
  p[i] <- test$p.value
  V[i] <- (test$statistic / (sum(tabla) * (min(dim(tabla)) - 1)))**0.5
  
  sueldo[i] <- 'TR_SUELDO'
}

p <- sprintf("%.2e", p)
V <- sprintf("%.2e", V)

dfT3 <- data.frame('Variable 1' = sueldo,
                   'Variable 2' = colNam,
                  'p-valor' = p,
                  'V de Cramer' = V,
                  check.names = FALSE)

kable(dfT3, format = "latex",booktabs = TRUE,
  caption = "p-valor y V de Cramer para el sueldo",
  align = 'c', longtable = TRUE,linesep = "")
```


Cuando el valor de p obtenido en dicho test es menor que 0.05 podemos concluir que hay una relación entre las dos variables categóricas sobre las que se ha aplicado el test, por tanto podemos decir que todas las variables se encuentran relacionadas en mayor o menor medida. La significancia estadística de dicha relación nos la de el valor de la V de Cramer, dicho estadístico consiste en una normalización del parámetro $\chi^2$ de modo que un mayor valor de la V de Cramer quiere decir que hay una mayor significancia estadística entre las variables. Ante dicho descubrimiento podríamos pensar que utilizar la variable *SEXO* es lo mejor. No obstante, esto no tiene ningún sentido, ya que teóricamente ambos sexos deberían tener las mismas oportunidades de forma laboral. Ante este hecho vamos a proceder a utilizar la variable *URAMA* para realizar la imputación de los datos. Cabe destacar que el V de Cramer también nos muestra que la variable *URAMA* es la que tiene mayor significancia estadística después de la variable *SEXO*.

A continuación se realiza la imputación condicional de la variable *TR_SUELDO* empleando la moda, el objetivo es completar los valores faltantes en la variable, la cual corresponde con el rango salarial de las personas encuestadas. Para garantizar la coherencia estadística se realiza imputación solamente en individuos que constan como "Trabajando", además se emplea la variable *RAMA* de manera condicional, usando como criterio de sustitución la moda salarial de cada rama.

Para poder imputar utilizando la rama deberíamos garantizar que los datos son MAR ('Missing at random'), es decir, que se han perdido de forma completamente aleatoria. Para poder observar si se cumple dicho propósito vamos a realizar una tabla con la frecuencia de datos faltantes en cada tipo del factor *URAMA*.
```{r, echo=FALSE}
dfAc <- df %>% filter(TRBPRN1 == 'Trabajando')

tabla_NA_rama <- as.data.frame.matrix(table(dfAc$URAMA, is.na(dfAc$TR_SUELDO)))
colnames(tabla_NA_rama) <- c("No faltantes", "Faltantes")
tabla_NA_rama$`Total casos` <- rowSums(tabla_NA_rama)
tabla_NA_rama$`% Faltantes` <- round(tabla_NA_rama$Faltantes / tabla_NA_rama$`Total casos` * 100, 2)

kable(tabla_NA_rama, format = "latex", booktabs = TRUE,
      caption = "Distribución de valores faltantes de la gente activa laboralmente en TR\\_SUELDO en función de la rama de estudio",
      align = 'c', longtable = TRUE, linesep = "")
```

Como podemos observar todas las columnas presentan una proporción de aproximadamente un 3 % de datos faltantes, esto nos garantiza que los datos faltantes están esparcidos de forma aleatoria dentro de nuestro conjunto. Por tanto, podemos aplicar una imputación del tipo moda sin preocuparnos por afectar en exceso a la estructura de los datos.

En primer lugar convertimos las variables *RAMA* y *TR_SUELDO* en factores ordenados. Esto es obligatorio ya que ambas variables son categóricas y presentan un número finito de niveles. Además, destacar la conversión de *TR_SUELDO* a factor ordinal ya que los rangos salariales deben tener un orden lógico, en este caso de menor a mayor. Esto permitirá ordenar correctamente las categorías y realizar comparaciones válidas entre niveles.

A continuación, se calcula la moda salarial, la cual corresponde con el nivel de sueldo más frecuente dentro de cada rama de estudio. Para calcularla se han considerado únicamente observaciones de los individuos que se encuentran trabajando y cuyo valor de *TR_SUELDO* no es NA.

El cálculo de la moda se lleva a cabo usando funciones de la librería *dplyr* *group_by* agrupa los registros por rama, *count* contabiliza la frecuencia de cada nivel salarial dentro del grupo, y *slice_max* selecciona el valor más frecuente (la moda) en cada rama. El resultado es una tabla auxiliar que asocia a cada rama su correspondiente moda salarial.

Cuando la moda salarial de cada rama está calculada, se puede comenzar la imputación. Empleando la función *left_join()*, se une la tabla de modas al conjunto de datos original a través de la variable *URAMA*. Luego, usando *mutate()* se reemplazan los valores NA con las condiciones *ifelse(TRBPRN1 == "Trabajando" & is.na(TR_SUELDO)*, es decir, que esté trabajando y que el valor sea NA, que es lo que se debe imputar. Tras la imputación, *TR_SUELDO* se reconvierte nuevamente en factor ordenado, asegurando que la variable conserva la estructura ordinal original y también las etiquetas.

Por útlimo, es posible verificar los resultados y la efectividad del proceso de imputación.

```{r, echo=FALSE}
# Creamos una copia del dataframe sin imputar

dfSI <- df

# Calculamos la moda sin tener en cuenta NA's

moda_por_rama <- df %>%
  filter(TRBPRN1 == "Trabajando",
         !is.na(TR_SUELDO)) %>%
  group_by(URAMA) %>% 
  count(URAMA, TR_SUELDO, sort = TRUE) %>%
  slice_max(n, n = 1, with_ties = FALSE) %>%
  transmute(URAMA,
            moda_sueldo = as.character(TR_SUELDO))

# Imputación con la moda 

df <- df %>%
  left_join(moda_por_rama, by = "URAMA") %>%
  mutate(
    TR_SUELDO = ifelse(
      TRBPRN1 == "Trabajando" & is.na(TR_SUELDO),
      moda_sueldo,   # usamos la moda de su rama
      as.character(TR_SUELDO) 
    )
  ) %>%
  select(-moda_sueldo)

# Convertimos tr_sueldo a factor ordenado otra vez
df$TR_SUELDO <- factor(df$TR_SUELDO,
                       levels = desc_sueldo,
                       ordered = TRUE)

# Calculamos cuántos valores se imputaron los na

imputaciones_por_rama <- df %>%
  filter(TRBPRN1 == "Trabajando") %>%
  group_by(URAMA) %>%
  summarise(
    Total_Registros = n(),
    Faltantes = sum(is.na(TR_SUELDO)),
    Completos = Total_Registros - Faltantes
  ) %>%
  mutate(
    Porcentaje_Completos = round((Completos / Total_Registros) * 100, 2)
  )

# Unimos las tablas
resumen_imputacion <- left_join(moda_por_rama, imputaciones_por_rama,
                                by = "URAMA")

```

Con el propósito de examinar la distribución *TR_SUELDO* antes y después de la imputación para ello recurrimos a la siguiente tabla.
```{r, echo=FALSE}
tabla_sueldo <- data.frame('Nivel salarial' = names(summary(df$TR_SUELDO)),
                  'Datos sin imputación' = 
                    as.vector(summary(dfSI$TR_SUELDO)),
                  'Datos con imputación' =
                    as.vector(summary(df$TR_SUELDO)),
                  check.names = FALSE)

kable(tabla_sueldo, format = "latex", booktabs = TRUE,
      caption = "Número de datos en los diferentes niveles salariales de la variable TR\\_SUELDO",
      align = 'c', longtable = TRUE, linesep = "")
```

Se oberva una imputación satisfactoria con reducción de aproximadamente 800 casos de NA en trabajador. No obstante, es necesario destacar todavía la presencia de 4527 valores faltantes, los cuales corresponden, como ya se ha comentado anteriormente, con NA de personas que no trabajan. Además, se muestra un distribución coherente con la esperada para variables salariales.

# Gráficas exploratorias

En este apartado, vamos a proceder a realizar diferentes gráficas que por nuestro tipo de datos serán gráficas de barras para observar como se separan los datos en función de las variables categóricas que utilicemos. Cabe destacar que en todos los casos vamos a proceder a utilizar el color para expresar otro variable dentro del mismo gráfico.


## Estudio de la inserción laboral

Para empezar, vamos a hacer dos gráficos de barras con la variable RAMA y URAMA para observar si hay mucha discrepancia entre ambas variables.
```{r figT1, echo=FALSE,fig.cap="Gráfico de barras de RAMA/URAMA coloreado con SEXO",fig.align = 'center', out.width = "0.6\\linewidth"}
p1 <- ggplot(data=df, aes(x = RAMA)) + geom_bar(aes(fill=SEXO)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) + 
  scale_y_continuous(limits = c(0, 16000))

p2 <- ggplot(data=df, aes(x = URAMA)) + geom_bar(aes(fill=SEXO)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) +
  scale_y_continuous(limits = c(0, 16000))

p1+p2
```
Como podemos observar los dos gráficos son muy similares, lo cual tiene sentido, ya que la gente suele realizar empezar estudios que tengan relación con sus estudios ya completados. A partir de estos gráficos también se observa como hay ramas como ingeniería y arquitectura donde predominan los hombres y otras como Ciencias sociales y jurídicas donde los alumnos son mayoritariamente mujeres.

Ahora gráficamos el tiempo transcurrido hasta encontrar trabajo en función del tipo de RAMA del estudio más importante realizado.
```{r figT3,echo=FALSE, fig.cap="Gráfico de barras del tiempo transcurrido hasta que empezo a trabajar coloreado con el tipo de RAMA del estudio más importante realizado",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(data=df, aes(x = HATR_E11)) + geom_bar(aes(fill=URAMA)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  scale_fill_brewer(palette = "Purples")
```

La anterior gráfica nos permite apreciar como la mayor parte de la gente tiende a continuar en el mismo trabajo que tenía después de finalizar la universidad. Podemos destacar que la gráfica presenta una tendencia descendiente, de modo que cuanto más tiempo pasa es menos probable que la gente se encuentre sin trabajo. No osbtante, observamos un aumento anómalo en la última columna con datos no vacíos, lo cual podría estar relacionado con la realización de estudios de post-grado como másteres o doctorados donde uno no está trabajando directamente pero ya ha finalizado su grado o licenciatura. Por otro lado, no parece haber una relación entre el tipo de la rama y el tiempo que se tarda en encontrar trabajo, ya que todas las columnas presentan proporciones similares de todos las ramas.

Para proseguir vamos a graficar la rama del estudio más elevado en función de la situación laboral.
```{r figT4,echo=FALSE, fig.cap="Gráfico de barras normalizado de la rama del estudio más elevado coloreado con la situación laboral",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(df, aes(x= URAMA)) + geom_bar(position = "fill",aes(fill=TRBPRN1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) +
  scale_fill_brewer(palette = "Greens")
```

Como podemos observar en la anterior gráfica, hay una cantidad mayor de gente que no se encuentra trabajando en las ramas de artes y humidades y ciencias sociales y ciencias jurídicas. No obstante, la diferencia con la cantidad de gente que no trabaja en las otras ramas es muy pequeña.


A continuación, vamos a proceder a realizar diferentes gráficos de barras del número de idiomas en función de la situación laboral, los cuales además estarán coloreados por el sexo.
```{r figT5,echo=FALSE, fig.cap="Gráficos de barras de el número de idiomas en función de la situación laboral y coloreado por el sexo",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(df, aes(x=IDIOMAS)) + geom_bar(aes(fill=SEXO)) + facet_wrap(~TRBPRN1) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))
```

Observamos como en todos los casos la columna con mayor peso es 1, lo cual nos indica que la gente suele enseñarse un único idioma diferente a los idiomas maternos. Dicha relación tiene sentido, ya que actualmente la gente suele centrarse en estudiar el inglés y dejar el resto de idiomas más de lado. También se puede notar que la segunda columna con más cantidad de datos es la de dos idiomas, dentro de la cual predomina el sexo femenino. Por otro lado, no parece haber una relación directa entre la cantidad de idiomas diferentes del materno que conoce el individuo con la situación laboral que este ostenta.

## Estudio del salario

En primer lugar vamos a gráficar la variación del sueldo según la rama de de estudio.

```{r figT6,echo=FALSE, fig.cap="Variación del sueldo según rama de estudio",fig.align = 'center', out.width = "0.6\\linewidth"}

ggplot(df %>% filter(TRBPRN1 == "Trabajando"),
       aes(x = RAMA, fill = TR_SUELDO)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

El proposito de esta gráfica es analizar la distribución de los niveles salariales, permitiendo identificar diferencias claras en la distribución entre ramas. Las ramas de Ingeniería y arquitectura y Ciencias de la salud presentan una mayor proporción de niveles salariales altos, lo que sugiere una mejor inserción laboral o remuneración media más elevada. En cambio, Artes y humanidades y Ciencias concentran una mayor proporción de sueldos en los tramos bajos o medios, reflejando una estructura salarial menos favorable. La rama de Ciencias sociales y jurídicas se sitúa en una posición intermedia, mostrando una distribución equilibrada entre niveles salariales medios y altos.

Seguidamente, podemos representar la rama del último estudio realizado coloreada con el sexo de los individuos.

```{r figT7,echo=FALSE, fig.cap="Distribución de hombres y mujeres por rama de estudio",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(df, aes(x = URAMA, fill = SEXO)) +
  geom_bar(position = "fill") +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
El objetivo de esta gráfica es mostrar la distribución proporcional del alumnado por sexo dentro de cada rama de estudio. De esta forma, se puede observar la representación relativa de hombres y mujeres en las diferentes áreas académicas y detectar posibles desequilibrios de género en la elección de estudios universitarios.

De manera general, las ramas de Ciencias de la salud, Artes y humanidades y Ciencias sociles y jurídicas, muestran una mayor proporción de mujeres, mientras que Ingeniería y arquitectura presenta una clara predominancia masculina. Por otro lado, la rama de Ciencias es la más equilibrada.

A continuación, podemos hacer una comparación de la distribución salarial según el sexo.

```{r figT8,echo=FALSE, fig.cap="Distribución salarial según sexo",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(df %>% filter(TRBPRN1 == "Trabajando"),
       aes(x = SEXO, fill = TR_SUELDO)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal()
```

El objetivo de esta gráfica es identificar si existen diferencias significativas en la estructura de los ingresos entre hombres y mujeres dentro de la población laboral activa analizada, evidenciando las disparidades de distribución entre hombres y mujeres.

Aunque las proporciones pueden variar según el contexto específico del estudio, la tendencia reflejada sugiere una mayor concentración de mujeres en los tramos salariales bajos o intermedios, mientras que los hombres presentan una mayor proporción en los rangos salariales altos.

Finalmente, procedemos a representar la relación entre número de idiomas y rango salarial.

```{r figT10,echo=FALSE, fig.cap="Distribución salarial según número de idiomas aprendidos",fig.align = 'center', out.width = "0.6\\linewidth"}
ggplot(df %>% filter(TRBPRN1 == "Trabajando", !is.na(IDIOMAS),
       !is.na(TR_SUELDO)),
       aes(x = IDIOMAS, fill = TR_SUELDO)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.5),
        plot.title = element_text(face = "bold"))

```
El objetivo de esta gráfica es analizar la relación entre el número de idiomas conocidos *IDIOMAS* y el nivel salarial *TR_SUELDO* entre las personas que se encuentran trabajando. A través de esta representación se pretende identificar si existe una tendencia ascendente en la remuneración a medida que aumenta el número de idiomas. De manera general, se observa una tendencia ascendente, no obstante, el gráfico también muestra un retroceso al alcanzar cinco idiomas o más.

# Conclusión

A lo largo de este proyecto hemos aprendido diferentes cosas tanto del conjunto de datos con el que estábamos tratando como del análisis exploratorio de datos en general. Nuestros objetivos desde un principio fueron utilizar el conjunto de datos proporcionado por el INE para estudiar la inserción laboral en función de las diferentes ramas del conocimiento y de intentar encontrar alguna relación del sueldo con la rama de estudio asociada.

Lo primero que aprendimos fue como tratar con un conjunto de datos real, ya que tuvimos que reducir las variables de nuestro dataframe y quedarnos solo con aquellas que coincidían con nuestros objetivos. Esto nos permitió pasar de un conjunto de datos con 299 a uno con 12. Cabe destacar que de estas 12 variables iniciales conseguimos combinar a aquellas que se relacionaban con la rama de los diferentes estudios en una sola, lo que nos redujo el conjunto a 8 variables.

Además de aprender a como tratar con las diferentes variables también tuvimos que realizar una reconversión del tipo de nuestros datos, ya que nuestras variables que eran del tipo factor se encontraban codificadas y en formato cadena. Para poder empezar a trabajar con dichas variables tuvimos que utilizar el *codebook* proporcionado por el INE para decodificar las variables y transformarlas en un factor cuyos niveles fueran fácilmente interpretables.

Seguidamente, nos dispusimos a estudiar la presencia de datos faltantes a lo largo de nuestras variables. En dicho proceso observamos que la variable que contenia el sueldo de los individuos poseía una gran cantidad de valores faltantes. A pesar de que gran parte de estos provenían de las personas que no se encontraban activas laboralmente, todavía seguía quedando una pequeña parte que no conseguíamos explicar. Dichos datos fueron tratados como MAR después de comprobar que se esparcían de forma similar entre las diferentes ramas del conocimiento, lo que nos permitió imputarlos utilizando la moda de cada rama del conocimiento. Para realizar dicho proceso antes comprobamos con el test $\chi^2$ y la V de Cramer que las variables *TR_SUELDO* y *URAMA* tenían una relación que era estadísticamente significativa.

Para finalizar con nuestro proyecto realizamos diferentes gráficos exploratorios en los que pudimos comprobar 






















